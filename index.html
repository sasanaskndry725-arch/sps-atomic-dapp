<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPS Super Pro DApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        background: #050505;
        font-family: Poppins, sans-serif;
        color: #fff;
        overflow-x: hidden;
    }

    /* SPS Neon Logo */
    .logo {
        text-align: center;
        margin-top: 20px;
        font-family: Orbitron;
        font-size: 42px;
        color: #00eaff;
        text-shadow: 0 0 10px #00eaff, 0 0 20px #00eaff;
        letter-spacing: 4px;
        animation: glow 2s infinite alternate;
    }

    @keyframes glow {
        from { text-shadow: 0 0 10px #0094ff; }
        to { text-shadow: 0 0 25px #00eaff; }
    }

    .container {
        width: 92%;
        margin: auto;
        margin-top: 15px;
        padding: 20px;
        background: rgba(255,255,255,0.06);
        border-radius: 14px;
        backdrop-filter: blur(8px);
        box-shadow: 0 0 20px rgba(0,255,255,0.1);
        animation: fadeIn 0.8s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    button {
        width: 100%;
        padding: 15px;
        margin-top: 12px;
        border: none;
        border-radius: 10px;
        background: linear-gradient(45deg,#00eaff,#0094ff);
        color: #000;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        transition: 0.3s;
    }

    button:hover {
        transform: scale(1.03);
        box-shadow: 0 0 12px #00eaff;
    }

    /* LED 0/1 Animation */
    .led-box {
        margin-top: 25px;
        text-align: center;
    }
    .led {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        margin: auto;
        background: red;
        box-shadow: 0 0 8px red;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0% { opacity: 0.25; }
        50% { opacity: 1; }
        100% { opacity: 0.25; }
    }

    .data-box {
        margin-top: 17px;
        padding: 12px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

<div class="logo">SPS</div>

<div class="container">
    <button onclick="connectWallet()">ğŸ”— Connect Wallet</button>
    <button onclick="loadUserInfo()">ğŸ“Š User Info</button>
    <button onclick="loadTree()">ğŸŒ³ My Tree Structure</button>
    <button onclick="registerUser()">ğŸŸ¦ Register (300 MATIC)</button>

    <div class="led-box">
        <div class="led" id="led"></div>
        <p style="font-size:13px;color:#0ff">Real-time Contract Sync</p>
    </div>

    <div id="output" class="data-box"></div>
</div>

<!-- ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
/* ------------------------------------------------------------------
   ABI ÙˆØ§Ù‚Ø¹ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Øª Ø§Ø² PolygonScan â€” Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ¨Ø§Ø±Ù‡!
------------------------------------------------------------------ */
const ABI = [
   /* ABI Ú©Ø§Ù…Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø´Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§Ø³Øª */
   /* Ø§Ø² Ø±ÙˆÛŒ PolygonScan Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ Ø§Ø³Øª */
   {
      "inputs": [{"internalType":"address","name":"ref","type":"address"}],
      "name":"Register",
      "outputs":[],
      "stateMutability":"payable",
      "type":"function"
   },
   {
      "inputs":[{"internalType":"address","name":"addr","type":"address"}],
      "name":"getUser",
      "outputs":[
          {"internalType":"address","name":"upline","type":"address"},
          {"internalType":"uint256","name":"directs","type":"uint256"},
          {"internalType":"uint256","name":"team","type":"uint256"},
          {"internalType":"uint256","name":"deposit","type":"uint256"}
      ],
      "stateMutability":"view",
      "type":"function"
   },
   {
      "inputs":[{"internalType":"address","name":"addr","type":"address"}],
      "name":"getTree",
      "outputs":[{"internalType":"address[]","name":"","type":"address[]"}],
      "stateMutability":"view",
      "type":"function"
   }
];

const CONTRACT = "0x7a7b06D49129B34976D07B3854d4D72D01588191";

let provider, signer, contract;

/* ----------------- CONNECT WALLET ------------------- */
async function connectWallet() {
    if (!window.ethereum) return alert("Install SafePal / MetaMask / Trust Wallet");

    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();

    contract = new ethers.Contract(CONTRACT, ABI, signer);

    document.getElementById("output").innerText =
        "Wallet Connected:\n" + await signer.getAddress();
}

/* ----------------- USER INFO ------------------------ */
async function loadUserInfo() {
    try {
        let addr = await signer.getAddress();
        let info = await contract.getUser(addr);

        document.getElementById("output").innerText =
            "ğŸ‘¤ User Info:\n" +
            "Upline: " + info.upline + "\n" +
            "Directs: " + info.directs + "\n" +
            "Team: " + info.team + "\n" +
            "Deposit: " + info.deposit;
    } catch (e) {
        document.getElementById("output").innerText = e.message;
    }
}

/* ---------------- TREE STRUCTURE -------------------- */
async function loadTree() {
    try {
        let addr = await signer.getAddress();
        let tree = await contract.getTree(addr);

        document.getElementById("output").innerText =
            "ğŸŒ³ Tree:\n" + tree.join("\n");
    } catch (e) {
        document.getElementById("output").innerText = e.message;
    }
}

/* ---------------- REGISTER (300 MATIC) --------------- */
async function registerUser() {
    try {
        let upline = prompt("Enter Upline Address:");
        if (!upline) return;

        let tx = await contract.Register(
            upline,
            { value: ethers.utils.parseEther("300") }
        );

        document.getElementById("output").innerText =
            "â³ Waiting...\nTX: " + tx.hash;

        await tx.wait();

        document.getElementById("output").innerText = "âœ… Success!";
    } catch (e) {
        document.getElementById("output").innerText = e.message;
    }
}
</script>

</body>
</html>
