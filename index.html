<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPS DApp - Ù†Ø³Ø®Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡</title>
    
    <!-- Ethers.js Ø§Ø² Cloudflare -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    
    <style>
        /* Reset Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ */
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.6);
            --ptoken-color: #8b5cf6;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        /* Ø²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú© */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            animation: float 20s infinite linear;
            opacity: 0.08;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(100vw, 100vh) rotate(360deg); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
            letter-spacing: 1px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ef4444;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-dot.connected { 
            background: #10b981;
            box-shadow: 0 0 15px #10b981;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .wallet-btn {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .wallet-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin: 25px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 14px 28px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.2));
            color: #3b82f6;
            border-bottom: 3px solid #3b82f6;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-box {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .stat-box:hover {
            transform: translateY(-8px);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            margin: 15px 0;
            color: #60a5fa;
        }
        
        .stat-box:nth-child(2) .stat-value {
            color: var(--ptoken-color);
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Tree Structure */
        .tree-container {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            min-height: 280px;
            overflow-x: auto;
            backdrop-filter: blur(5px);
        }
        
        .tree-node {
            padding: 15px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.6));
            border-radius: 10px;
            margin: 8px 0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            position: relative;
            transition: all 0.3s;
        }
        
        .tree-node:hover {
            border-color: #3b82f6;
            transform: translateX(-5px);
        }
        
        .tree-node.main {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.2));
            border-color: #3b82f6;
        }
        
        .tree-children {
            margin-right: 40px;
            margin-top: 15px;
            border-right: 3px dashed rgba(59, 130, 246, 0.4);
            padding-right: 20px;
            position: relative;
        }
        
        .tree-level-1 .tree-children {
            border-right-color: rgba(16, 185, 129, 0.4);
        }
        
        .tree-level-2 .tree-children {
            border-right-color: rgba(245, 158, 11, 0.4);
        }
        
        .tree-badge {
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(5px);
        }
        
        .card h3 {
            margin-bottom: 20px;
            color: #e2e8f0;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 12px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 15px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* Buttons */
        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981, #34d399);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444, #f87171);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .tabs {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Status Messages */
        .status {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 600;
            border: 2px solid transparent;
            background: rgba(30, 41, 59, 0.8);
        }
        
        .status.success {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .status.info {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        /* Transaction Status - Ø·Ø±Ø§Ø­ÛŒ Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ± */
        .tx-status {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tx-success {
            border-left: 4px solid #10b981;
        }
        
        .tx-pending {
            border-left: 4px solid #f59e0b;
        }
        
        .tx-error {
            border-left: 4px solid #ef4444;
        }
        
        .tx-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            color: #60a5fa;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tx-link:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(-5px);
        }
        
        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø²ÛŒØ¨Ø§ */
        .validation {
            margin-top: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .validation.valid { color: #34d399; }
        .validation.invalid { color: #f87171; }
    </style>
</head>
<body>
    <!-- Ø²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú© -->
    <div class="bg-animation">
        <div class="particles" id="particles"></div>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">SPS</div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="networkStatus">Ø§ØªØµØ§Ù„ Ø´Ø¨Ú©Ù‡</span>
                </div>
            </div>
            
            <button class="wallet-btn" id="connectBtn">
                <span>ğŸ‘›</span> Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„
            </button>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            <button class="tab-btn" onclick="showTab('register')">ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
            <button class="tab-btn" onclick="showTab('miner')">â›ï¸ Ù…Ø§ÛŒÙ†Ø±</button>
            <button class="tab-btn" onclick="showTab('actions')">ğŸ’¸ Ø¹Ù…Ù„ÛŒØ§Øª</button>
            <button class="tab-btn" onclick="showTab('admin')" id="adminTab" style="display:none">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboardTab">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø³ØªØ®Ø±</div>
                    <div class="stat-value" id="poolBalance">0</div>
                    <div class="stat-unit">MATIC</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">â›ï¸ Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø±</div>
                    <div class="stat-value" id="minerPool">0</div>
                    <div class="stat-unit">pToken</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ğŸ Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡</div>
                    <div class="stat-value" id="specialPool">0</div>
                    <div class="stat-unit">MATIC</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ğŸ« Ú©Ø§Ø±Ù…Ø²Ø¯ ÙˆØ±ÙˆØ¯</div>
                    <div class="stat-value" id="entryFeeDisplay">0</div>
                    <div class="stat-unit">MATIC</div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <h3>ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ</h3>
                    <div id="userInfo" class="status info">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ”—</div>
                            Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ğŸŒ³ Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø®ØªÛŒ Ø´Ø¨Ú©Ù‡ Ø´Ù…Ø§</h3>
                    <div class="tree-container" id="treeContainer">
                        <div class="tree-node main">
                            <strong>ğŸ”„ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø§Ø®ØªØ§Ø± Ø´Ø¨Ú©Ù‡ØŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø±Ø§ Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Register Tab -->
        <div id="registerTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
                    <div class="form-group">
                        <label class="form-label">ğŸ”¢ Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ† (ID)</label>
                        <input type="number" id="uplineCode" class="form-input" placeholder="1" min="1">
                        <div class="validation" id="uplineValidation"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ</label>
                        <select id="position" class="form-input">
                            <option value="true">â¬…ï¸ Ø³Ù…Øª Ú†Ù¾</option>
                            <option value="false">â¡ï¸ Ø³Ù…Øª Ø±Ø§Ø³Øª</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="register()">
                        <span>âœ…</span> Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… (300 MATIC)
                    </button>
                    <div id="registerResult"></div>
                </div>
                
                <div class="card">
                    <h3>ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h3>
                    <div id="registerInfo" class="status info">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“‹</div>
                            Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ù…Ø§ Ù¾Ø³ Ø§Ø² Ø§ØªØµØ§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Miner Tab -->
        <div id="minerTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>â›ï¸ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÛŒÙ†ÛŒÙ†Ú¯</h3>
                    <div class="form-group">
                        <label class="form-label">ğŸ’° Ù…Ù‚Ø¯Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª (MATIC)</label>
                        <input type="text" id="contribution" class="form-input" placeholder="0.1" pattern="[0-9]*\.?[0-9]+">
                        <div class="validation" id="contributionValidation"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="contribute()">
                            <span>ğŸ’</span> Ù…Ø´Ø§Ø±Ú©Øª
                        </button>
                        <button class="btn btn-warning" onclick="buyTokens()">
                            <span>ğŸ›’</span> Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ù…Ø§ÛŒÙ†Ø±
                        </button>
                        <button class="btn btn-primary" onclick="distribute()">
                            <span>ğŸ“¤</span> ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§
                        </button>
                    </div>
                    <div id="minerResult"></div>
                </div>
                
                <div class="card">
                    <h3>ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§ÛŒÙ†Ø±</h3>
                    <div id="minerInfo" class="status info">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">â›ï¸</div>
                            Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§ÛŒÙ†ÛŒÙ†Ú¯ Ø´Ù…Ø§
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions Tab -->
        <div id="actionsTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</h3>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="withdrawPool()">
                            <span>ğŸ¦</span> Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø± Ø§ØµÙ„ÛŒ
                        </button>
                        <button class="btn btn-primary" onclick="withdrawSpecial()">
                            <span>ğŸ</span> Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡
                        </button>
                    </div>
                    <div id="withdrawResult"></div>
                </div>
                
                <div class="card">
                    <h3>ğŸ“ˆ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</h3>
                    <div id="withdrawInfo" class="status info">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ’³</div>
                            ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="adminTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</h3>
                    <div class="form-group">
                        <label class="form-label">ğŸ’° Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¬Ø¯ÛŒØ¯ (wei)</label>
                        <input type="number" id="newFee" class="form-input" placeholder="300000000000000000000">
                        <div class="validation">1 wei = 0.000000000000000001 MATIC</div>
                    </div>
                    <button class="btn btn-danger" onclick="updateFee()">
                        <span>ğŸ”„</span> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ù…Ø²Ø¯
                    </button>
                    <div id="adminResult"></div>
                </div>
                
                <div class="card">
                    <h3>ğŸš« Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§</h3>
                    <div class="form-group">
                        <label class="form-label">ğŸ“‹ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø­Ø°Ù (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)</label>
                        <textarea id="addresses" class="form-input" rows="5" placeholder="0x1234...abcd,0x5678...efgh"></textarea>
                        <div class="validation" id="addressValidation"></div>
                    </div>
                    <button class="btn btn-danger" onclick="removeMiners()">
                        <span>ğŸ—‘ï¸</span> Ø­Ø°Ù Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            SPS Network â€¢ Ø¢Ø¯Ø±Ø³ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯: 0x7a7b06D49129B34976D07B3854d4D72D01588191<br>
            Ø´Ø¨Ú©Ù‡: Polygon Mainnet â€¢ Ù†Ø³Ø®Ù‡: 3.0 Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡
        </div>
    </div>

    <script>
        // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ ====================
        const CONTRACT_ADDRESS = "0x7a7b06D49129B34976D07B3854d4D72D01588191";
        const POLYGON_CHAIN_ID = "0x89";
        const ENTRY_FEE = "300000000000000000000"; // 300 MATIC
        
        // ABI Ú©Ø§Ù…Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ù‡Ù…Ø§Ù† Ù†Ø³Ø®Ù‡ Ù‚Ø¨Ù„ÛŒ)
        const CONTRACT_ABI = [
            {"inputs":[{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"message","type":"string"}],"name":"DebugMessage","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"EntryFeeUpdated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"poolType","type":"string"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ManualWithdraw","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"contributor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"MinerPoolContribution","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"MinerRemoved","type":"event"},
            {"anonymous":false,"inputs":[{"indexed: false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"MinerTokensBought","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"poolType","type":"string"}],"name":"NoEligibleUsers","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"upline","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"Registered","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"}],"name":"UserMigrated","type":"event"},
            {"inputs":[],"name":"CYCLE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"ENTRY_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"MAX_CYCLE_BALANCES","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"MINER_BUY_INTERVAL","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"PTOKEN_CONTRACT","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"_getSpecialUserInfoForMigrateToNewFork","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userAddress","type":"address"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"address","name":"upline","type":"address"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address[]","name":"usersToRemove","type":"address[]"}],"name":"batchRemoveMiners","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"buyMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"contributeToMinerPool","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[],"name":"distributeMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"eligiblePoolUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"eligibleSpecialUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getMinerStats","outputs":[{"internalType":"uint256","name":"checkedOutPaidCount","type":"uint256"},{"internalType":"uint256","name":"eligibleInProgressCount","type":"uint256"},{"internalType":"uint256","name":"totalRemain","type":"uint256"},{"internalType":"uint256","name":"networkerCount","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"percent","type":"uint256"}],"name":"getMinerStatsByPercent","outputs":[{"internalType":"uint256","name":"usersAbovePercent","type":"uint256"},{"internalType":"uint256","name":"totalRemaining","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getSpecialPoolParticipants","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getTokenPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"getUserDirects","outputs":[{"internalType":"uint256","name":"leftId","type":"uint256"},{"internalType":"uint256","name":"rightId","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint8","name":"day","type":"uint8"}],"name":"isCurrentTimeMatchToDay","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"isPoolWithdrawable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"lastMinerBuyTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"lastPoolWithdrawTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"minerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"minerTokenPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"address","name":"leftChildAddress","type":"address"},{"internalType":"address","name":"rightChildAddress","type":"address"},{"internalType":"uint256","name":"oldLeftCount","type":"uint256"},{"internalType":"uint256","name":"oldRightCount","type":"uint256"},{"internalType":"uint256","name":"oldLeftSave","type":"uint256"},{"internalType":"uint256","name":"oldRightSave","type":"uint256"}],"name":"mpu","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"ownerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"pendingMinerFunds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"uplineCode","type":"uint256"},{"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[],"name":"specialPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"specialPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"specialRewardPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"updateEntryFee","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"userTokenPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"withdrawPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"withdrawSpecials","outputs":[],"stateMutability":"nonpayable","type":"function"}
        ];
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        let provider, signer, contract, userAddress, isOwner = false;
        let userTreeData = {};
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function showStatus(message, type = 'info', targetId = 'userInfo') {
            const el = document.getElementById(targetId);
            el.className = `status ${type}`;
            el.innerHTML = message;
            console.log(`[${type.toUpperCase()}] ${message.replace(/<[^>]*>/g, '')}`);
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
        
        function showTab(tabName) {
            const tabs = ['dashboard', 'register', 'miner', 'actions', 'admin'];
            tabs.forEach(id => {
                document.getElementById(id + 'Tab').style.display = 'none';
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                loadDashboard();
            }
        }
        
        function createParticles() {
            const particles = document.getElementById('particles');
            particles.innerHTML = '';
            for (let i = 0; i < 60; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const size = Math.random() * 12 + 3;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 20}s`;
                particle.style.animationDuration = `${Math.random() * 15 + 25}s`;
                particle.style.opacity = `${Math.random() * 0.1 + 0.05}`;
                particles.appendChild(particle);
            }
        }
        
        function updateNetworkStatus(connected) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('networkStatus');
            
            if (connected) {
                dot.className = 'status-dot connected';
                text.textContent = 'Polygon Mainnet';
            } else {
                dot.className = 'status-dot';
                text.textContent = 'Ø§ØªØµØ§Ù„ Ø´Ø¨Ú©Ù‡';
            }
        }
        
        function showTransactionResult(txHash, type = 'pending', message = '', targetId) {
            const statusClass = type === 'success' ? 'tx-success' : 
                               type === 'error' ? 'tx-error' : 'tx-pending';
            
            const icons = {
                'success': 'âœ…',
                'error': 'âŒ',
                'pending': 'â³'
            };
            
            const titles = {
                'success': 'Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù…ÛŒØ²',
                'error': 'Ø®Ø·Ø§',
                'pending': 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´'
            };
            
            let html = `
                <div class="tx-status ${statusClass}">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">${icons[type]}</span>
                        <strong style="font-size: 16px;">${titles[type]}</strong>
                    </div>
                    <div style="font-size: 14px; color: #cbd5e1; margin-bottom: 12px;">${message}</div>
            `;
            
            if (txHash) {
                const link = `https://polygonscan.com/tx/${txHash}`;
                html += `
                    <a href="${link}" target="_blank" class="tx-link">
                        <span>ğŸ”</span> Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Polygonscan
                    </a>
                `;
            }
            
            html += `</div>`;
            
            const target = document.getElementById(targetId);
            target.innerHTML = html;
        }
        
        // ==================== Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø®ØªÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ====================
        async function loadAdvancedTreeStructure(userId, level = 0, maxLevel = 3) {
            try {
                if (level >= maxLevel) return '';
                
                const userInfo = await contract.getUserInfo(userAddress);
                const [leftId, rightId] = await contract.getUserDirects(userId);
                
                let treeHtml = '';
                
                // Ú¯Ø±Ù‡ Ø§ØµÙ„ÛŒ
                if (level === 0) {
                    treeHtml += `
                        <div class="tree-node main tree-level-${level}">
                            <span class="tree-badge">Ø´Ù…Ø§</span>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 8px;">ğŸ‘¤ ID: ${userId}</div>
                            <div style="display: flex; gap: 20px; font-size: 14px;">
                                <div>â¬…ï¸ Ú†Ù¾: <strong>${userInfo[2]}</strong></div>
                                <div>â¡ï¸ Ø±Ø§Ø³Øª: <strong>${userInfo[3]}</strong></div>
                            </div>
                            <div style="margin-top: 8px; color: #94a3b8; font-size: 13px;">
                                Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${userInfo[6]} ÙˆØ§Ø­Ø¯
                            </div>
                        </div>
                    `;
                }
                
                // Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
                if (leftId > 0 || rightId > 0) {
                    treeHtml += `<div class="tree-children">`;
                    
                    if (leftId > 0) {
                        treeHtml += `
                            <div class="tree-node tree-level-${level + 1}">
                                <span class="tree-badge" style="background: #10b981;">Ú†Ù¾</span>
                                <div style="font-weight: bold;">â¬…ï¸ ID: ${leftId}</div>
                                <div style="font-size: 12px; color: #94a3b8; margin-top: 5px;">
                                    â†ª Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª
                                </div>
                            </div>
                        `;
                        
                        // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ Ø³Ø·ÙˆØ­ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
                        if (level < maxLevel - 1) {
                            // treeHtml += await loadAdvancedTreeStructure(leftId, level + 1, maxLevel);
                        }
                    }
                    
                    if (rightId > 0) {
                        treeHtml += `
                            <div class="tree-node tree-level-${level + 1}">
                                <span class="tree-badge" style="background: #f59e0b;">Ø±Ø§Ø³Øª</span>
                                <div style="font-weight: bold;">â¡ï¸ ID: ${rightId}</div>
                                <div style="font-size: 12px; color: #94a3b8; margin-top: 5px;">
                                    â†ª Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª
                                </div>
                            </div>
                        `;
                        
                        // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ Ø³Ø·ÙˆØ­ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
                        if (level < maxLevel - 1) {
                            // treeHtml += await loadAdvancedTreeStructure(rightId, level + 1, maxLevel);
                        }
                    }
                    
                    treeHtml += `</div>`;
                } else if (level === 0) {
                    treeHtml += `
                        <div class="tree-node" style="margin-top: 15px; background: rgba(30, 41, 59, 0.5);">
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 40px; margin-bottom: 10px;">ğŸŒ±</div>
                                <strong>Ø´Ø¨Ú©Ù‡ Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯ Ø§Ø³Øª</strong>
                                <div style="margin-top: 10px; color: #94a3b8; font-size: 14px;">
                                    Ù‡Ù†ÙˆØ² Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯. Ø§Ø² ØªØ¨ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return treeHtml;
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø®ØªÛŒ:', error);
                return `<div class="tree-node">âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ø´Ø¨Ú©Ù‡</div>`;
            }
        }
        
        // ==================== Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…â€ŒÙ‡Ø§ ====================
        function setupFormValidations() {
            const contributionInput = document.getElementById('contribution');
            const uplineInput = document.getElementById('uplineCode');
            
            if (contributionInput) {
                contributionInput.addEventListener('input', function(e) {
                    const value = e.target.value;
                    const validation = document.getElementById('contributionValidation');
                    
                    if (!value || isNaN(value) || parseFloat(value) <= 0) {
                        validation.innerHTML = 'âŒ Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
                        validation.className = 'validation invalid';
                    } else {
                        validation.innerHTML = 'âœ… Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
                        validation.className = 'validation valid';
                    }
                });
            }
            
            if (uplineInput) {
                uplineInput.addEventListener('input', function(e) {
                    const value = e.target.value;
                    const validation = document.getElementById('uplineValidation');
                    
                    if (!value || parseInt(value) < 1) {
                        validation.innerHTML = 'âŒ Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯';
                        validation.className = 'validation invalid';
                    } else {
                        validation.innerHTML = 'âœ… Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ† Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
                        validation.className = 'validation valid';
                    }
                });
            }
        }
        
        // ==================== Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ ====================
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showStatus('âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ (Ù…Ø«Ù„ MetaMask) ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                return;
            }
            
            try {
                showLoading(true);
                showStatus('ğŸ”— Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„...', 'info');
                
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                userAddress = accounts[0];
                updateNetworkStatus(false);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¨Ú©Ù‡
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== POLYGON_CHAIN_ID) {
                    showTransactionResult(null, 'info', 'Ø¯Ø± Ø­Ø§Ù„ ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Polygon...', 'userInfo');
                    
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: POLYGON_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: POLYGON_CHAIN_ID,
                                    chainName: 'Polygon Mainnet',
                                    nativeCurrency: { name: 'MATIC', symbol: 'MATIC', decimals: 18 },
                                    rpcUrls: ['https://polygon-rpc.com'],
                                    blockExplorerUrls: ['https://polygonscan.com']
                                }],
                            });
                        }
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
                
                // Ø§ØªØµØ§Ù„
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                document.getElementById('connectBtn').outerHTML = `
                    <div style="background: linear-gradient(90deg, #10b981, #34d399); color: white; padding: 14px 28px; border-radius: 10px; font-weight: bold; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                        <span>ğŸ‘›</span> 
                        <div>
                            <div style="font-size: 14px; opacity: 0.9;">Ù…ØªØµÙ„ Ø´Ø¯</div>
                            <div style="font-size: 12px; font-family: monospace;">${userAddress.substring(0, 8)}...${userAddress.substring(36)}</div>
                        </div>
                    </div>
                `;
                
                updateNetworkStatus(true);
                await loadDashboard();
                showTransactionResult(null, 'success', 'Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…ØªØµÙ„ Ø´Ø¯', 'userInfo');
                
                // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                window.ethereum.on('accountsChanged', () => location.reload());
                window.ethereum.on('chainChanged', () => location.reload());
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${error.message}`, 'userInfo');
            } finally {
                showLoading(false);
            }
        }
        
        // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ====================
        async function loadDashboard() {
            if (!contract) return;
            
            try {
                // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ
                const [poolBalance, minerPool, specialPool, entryFee] = await Promise.all([
                    contract.poolBalance().catch(() => 0),
                    contract.minerTokenPool().catch(() => 0),
                    contract.specialRewardPool().catch(() => 0),
                    contract.ENTRY_FEE().catch(() => ENTRY_FEE)
                ]);
                
                // Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø¹Ø¯Ø§Ø¯
                const formatNumber = (num, decimals = 4) => {
                    const formatted = ethers.formatEther(num);
                    const [integer, fraction] = formatted.split('.');
                    if (!fraction) return integer;
                    return `${integer}.${fraction.substring(0, decimals)}`;
                };
                
                document.getElementById('poolBalance').textContent = formatNumber(poolBalance, 2);
                document.getElementById('minerPool').textContent = formatNumber(minerPool, 0);
                document.getElementById('specialPool').textContent = formatNumber(specialPool, 2);
                document.getElementById('entryFeeDisplay').textContent = formatNumber(entryFee, 0);
                
                // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                const userInfo = await contract.getUserInfo(userAddress).catch(() => null);
                if (userInfo) {
                    const userId = userInfo[0];
                    
                    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø±Ø®ØªÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
                    const treeHtml = await loadAdvancedTreeStructure(userId);
                    document.getElementById('treeContainer').innerHTML = treeHtml;
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                    showStatus(`
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; color: #94a3b8;">Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ</div>
                                <div style="font-size: 20px; font-weight: bold;">#${userId}</div>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; color: #94a3b8;">ÙˆØ¶Ø¹ÛŒØª Ù…Ø§ÛŒÙ†Ø±</div>
                                <div style="font-size: 20px; font-weight: bold;">${userInfo[10] ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}</div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; color: #94a3b8;">Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
                                <div style="font-size: 20px; font-weight: bold;">${userInfo[6]}</div>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; color: #94a3b8;">Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡</div>
                                <div style="font-size: 20px; font-weight: bold;">${userInfo[7]}</div>
                            </div>
                        </div>
                    `, 'success');
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø§Ù„Ú© Ø¨ÙˆØ¯Ù†
                    const owner = await contract.owner().catch(() => null);
                    if (owner && owner.toLowerCase() === userAddress.toLowerCase()) {
                        isOwner = true;
                        document.getElementById('adminTab').style.display = 'block';
                    }
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', error);
            }
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ====================
        
        async function register() {
            const uplineCode = document.getElementById('uplineCode').value;
            const position = document.getElementById('position').value === 'true';
            
            if (!uplineCode || parseInt(uplineCode) < 1) {
                showTransactionResult(null, 'error', 'Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'registerResult');
                return;
            }
            
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯...', 'registerResult');
                
                const tx = await contract.register(uplineCode, position, {
                    value: ENTRY_FEE
                });
                
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯...', 'registerResult');
                
                const receipt = await tx.wait();
                showTransactionResult(tx.hash, 'success', 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯! Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú¯Ø±Ø¯ÛŒØ¯.', 'registerResult');
                
                await loadDashboard();
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: ${error.message}`, 'registerResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function contribute() {
            const amount = document.getElementById('contribution').value;
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                showTransactionResult(null, 'error', 'Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'minerResult');
                return;
            }
            
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ ${amount} MATIC Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©Øª...`, 'minerResult');
                
                const tx = await contract.contributeToMinerPool({
                    value: ethers.parseEther(amount)
                });
                
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø´Ø§Ø±Ú©Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯...', 'minerResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', `Ù…Ø´Ø§Ø±Ú©Øª ${amount} MATIC Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.`, 'minerResult');
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ù…Ø´Ø§Ø±Ú©Øª: ${error.message}`, 'minerResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function buyTokens() {
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ù…Ø§ÛŒÙ†Ø±...', 'minerResult');
                
                const tx = await contract.buyMinerTokens();
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'minerResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', 'Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ù…Ø§ÛŒÙ†Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.', 'minerResult');
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù†: ${error.message}`, 'minerResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function distribute() {
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§ÛŒÙ†Ø±...', 'minerResult');
                
                const tx = await contract.distributeMinerTokens();
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ ØªÙˆØ²ÛŒØ¹ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'minerResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', 'ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§ÛŒÙ†Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙˆØ²ÛŒØ¹ Ø´Ø¯Ù†Ø¯.', 'minerResult');
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± ØªÙˆØ²ÛŒØ¹: ${error.message}`, 'minerResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function withdrawPool() {
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø± Ø§ØµÙ„ÛŒ...', 'withdrawResult');
                
                const tx = await contract.withdrawPool();
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'withdrawResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', 'Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø± Ø§ØµÙ„ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.', 'withdrawResult');
                await loadDashboard();
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø¯Ø§Ø´Øª: ${error.message}`, 'withdrawResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function withdrawSpecial() {
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡...', 'withdrawResult');
                
                const tx = await contract.withdrawSpecials();
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'withdrawResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', 'Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øª Ø´Ø¯.', 'withdrawResult');
                await loadDashboard();
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´: ${error.message}`, 'withdrawResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function updateFee() {
            if (!isOwner) {
                showTransactionResult(null, 'error', 'Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯: ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ø¯.', 'adminResult');
                return;
            }
            
            const newFee = document.getElementById('newFee').value;
            if (!newFee) {
                showTransactionResult(null, 'error', 'Ù„Ø·ÙØ§Ù‹ Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'adminResult');
                return;
            }
            
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ù…Ø²Ø¯ ÙˆØ±ÙˆØ¯...', 'adminResult');
                
                const tx = await contract.updateEntryFee(newFee);
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'adminResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', 'Ú©Ø§Ø±Ù…Ø²Ø¯ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.', 'adminResult');
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${error.message}`, 'adminResult');
            } finally {
                showLoading(false);
            }
        }
        
        async function removeMiners() {
            if (!isOwner) {
                showTransactionResult(null, 'error', 'Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯: ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ø¯.', 'adminResult');
                return;
            }
            
            const addressesText = document.getElementById('addresses').value;
            if (!addressesText) {
                showTransactionResult(null, 'error', 'Ù„Ø·ÙØ§Ù‹ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'adminResult');
                return;
            }
            
            const addresses = addressesText.split(',').map(a => a.trim()).filter(a => ethers.isAddress(a));
            if (addresses.length === 0) {
                showTransactionResult(null, 'error', 'Ù‡ÛŒÚ† Ø¢Ø¯Ø±Ø³ Ù…Ø¹ØªØ¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.', 'adminResult');
                return;
            }
            
            try {
                showLoading(true);
                showTransactionResult(null, 'pending', `Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù ${addresses.length} Ù…Ø§ÛŒÙ†Ø±...`, 'adminResult');
                
                const tx = await contract.batchRemoveMiners(addresses);
                showTransactionResult(tx.hash, 'pending', 'ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø°Ù Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.', 'adminResult');
                
                await tx.wait();
                showTransactionResult(tx.hash, 'success', `${addresses.length} Ù…Ø§ÛŒÙ†Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯Ù†Ø¯.`, 'adminResult');
                
            } catch (error) {
                showTransactionResult(null, 'error', `Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§: ${error.message}`, 'adminResult');
            } finally {
                showLoading(false);
            }
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        window.onload = function() {
            console.log('ğŸš€ SPS DApp Ù†Ø³Ø®Ù‡ 3.0 Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯');
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú©
            createParticles();
            
            // ØªÙ†Ø¸ÛŒÙ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…â€ŒÙ‡Ø§
            setupFormValidations();
            
            // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡
            document.getElementById('connectBtn').onclick = connectWallet;
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ¨ Ù…Ø§ÛŒÙ†Ø±
            const minerTabBtn = document.querySelector('.tab-btn[onclick*="miner"]');
            if (minerTabBtn) {
                minerTabBtn.onclick = function() { showTab('miner'); };
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø±
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            setTimeout(() => connectWallet(), 1000);
                        }
                    });
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
            setTimeout(() => {
                if (!provider) loadDashboard();
            }, 500);
        };
    </script>
</body>
</html>