<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPS DApp - Ø§Ø¬Ø±Ø§ÛŒ Ú©Ø§Ù…Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</title>
    
    <!-- Ethers.js Ø§Ø² Cloudflare - Ù‚Ø·Ø¹ÛŒ Ù†Ø¯Ø§Ø±Ø¯ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    
    <style>
        /* Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Tahoma, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .wallet-btn {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .wallet-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
        }
        
        .tab-btn.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #e2e8f0;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #60a5fa;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 14px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #cbd5e1;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981, #34d399);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444, #f87171);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Log */
        .log-box {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status */
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .status.success {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        .status.info {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">SPS NETWORK</div>
                <button class="wallet-btn" id="connectBtn">Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('dashboard')">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
                <button class="tab-btn" onclick="showTab('register')">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
                <button class="tab-btn" onclick="showTab('actions')">Ø¹Ù…Ù„ÛŒØ§Øª</button>
                <button class="tab-btn" onclick="showTab('admin')" id="adminTab" style="display:none">Ù…Ø¯ÛŒØ±ÛŒØª</button>
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboardTab">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</div>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø³ØªØ®Ø±</div>
                    <div class="stat-value" id="poolBalance">0 MATIC</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø±</div>
                    <div class="stat-value" id="minerPool">0 MATIC</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡</div>
                    <div class="stat-value" id="specialPool">0 MATIC</div>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ</h3>
                <div id="userInfo" class="status info">
                    Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª
                </div>
            </div>
        </div>
        
        <!-- Register Tab -->
        <div id="registerTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¬Ø¯ÛŒØ¯</h3>
                    <div class="form-group">
                        <label class="form-label">Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ†</label>
                        <input type="number" id="uplineCode" class="form-input" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù…ÙˆÙ‚Ø¹ÛŒØª</label>
                        <select id="position" class="form-input">
                            <option value="true">Ú†Ù¾</option>
                            <option value="false">Ø±Ø§Ø³Øª</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="register()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… (0.1 MATIC)</button>
                </div>
                
                <div class="card">
                    <h3>ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h3>
                    <div id="registerInfo" class="status info">
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions Tab -->
        <div id="actionsTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>â›ï¸ Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø±</h3>
                    <div class="form-group">
                        <label class="form-label">Ù…Ù‚Ø¯Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª (MATIC)</label>
                        <input type="text" id="contribution" class="form-input" placeholder="0.1">
                    </div>
                    <button class="btn btn-success" onclick="contribute()">Ù…Ø´Ø§Ø±Ú©Øª</button>
                    <button class="btn btn-warning" onclick="buyTokens()">Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù†</button>
                    <button class="btn btn-primary" onclick="distribute()">ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</button>
                </div>
                
                <div class="card">
                    <h3>ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</h3>
                    <button class="btn btn-success" onclick="withdrawPool()">Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø±</button>
                    <button class="btn btn-primary" onclick="withdrawSpecial()">Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡</button>
                </div>
            </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="adminTab" style="display:none">
            <div class="grid-2">
                <div class="card">
                    <h3>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h3>
                    <div class="form-group">
                        <label class="form-label">Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¬Ø¯ÛŒØ¯ (wei)</label>
                        <input type="number" id="newFee" class="form-input" placeholder="100000000000000000">
                    </div>
                    <button class="btn btn-danger" onclick="updateFee()">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ù…Ø²Ø¯</button>
                </div>
                
                <div class="card">
                    <h3>ğŸš« Ù…Ø¯ÛŒØ±ÛŒØª</h3>
                    <div class="form-group">
                        <label class="form-label">Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø­Ø°Ù (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§)</label>
                        <textarea id="addresses" class="form-input" rows="4" placeholder="0x123...,0x456..."></textarea>
                    </div>
                    <button class="btn btn-danger" onclick="removeMiners()">Ø­Ø°Ù Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§</button>
                </div>
            </div>
        </div>
        
        <!-- Log Box -->
        <div class="card">
            <h3>ğŸ“‹ Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ…</h3>
            <div class="log-box" id="logBox">
                <div class="log-item">Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª...</div>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            SPS Network â€¢ Ø¢Ø¯Ø±Ø³ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯: 0x7a7b06D49129B34976D07B3854d4D72D01588191 â€¢ Polygon Mainnet
        </div>
    </div>

    <script>
        // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ ====================
        const CONTRACT_ADDRESS = "0x7a7b06D49129B34976D07B3854d4D72D01588191";
        const POLYGON_CHAIN_ID = "0x89";
        const ENTRY_FEE = "100000000000000000"; // 0.1 MATIC
        
        // ABI Ú©Ø§Ù…Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        const CONTRACT_ABI = [
            {"inputs":[{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"message","type":"string"}],"name":"DebugMessage","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"EntryFeeUpdated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"poolType","type":"string"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ManualWithdraw","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"contributor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"MinerPoolContribution","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"MinerRemoved","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"MinerTokensBought","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"poolType","type":"string"}],"name":"NoEligibleUsers","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"upline","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"Registered","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"}],"name":"UserMigrated","type":"event"},
            {"inputs":[],"name":"CYCLE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"ENTRY_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"MAX_CYCLE_BALANCES","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"MINER_BUY_INTERVAL","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"PTOKEN_CONTRACT","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"_getSpecialUserInfoForMigrateToNewFork","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userAddress","type":"address"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"address","name":"upline","type":"address"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address[]","name":"usersToRemove","type":"address[]"}],"name":"batchRemoveMiners","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"buyMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"contributeToMinerPool","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[],"name":"distributeMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"eligiblePoolUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"eligibleSpecialUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getMinerStats","outputs":[{"internalType":"uint256","name":"checkedOutPaidCount","type":"uint256"},{"internalType":"uint256","name":"eligibleInProgressCount","type":"uint256"},{"internalType":"uint256","name":"totalRemain","type":"uint256"},{"internalType":"uint256","name":"networkerCount","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"percent","type":"uint256"}],"name":"getMinerStatsByPercent","outputs":[{"internalType":"uint256","name":"usersAbovePercent","type":"uint256"},{"internalType":"uint256","name":"totalRemaining","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getSpecialPoolParticipants","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getTokenPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"getUserDirects","outputs":[{"internalType":"uint256","name":"leftId","type":"uint256"},{"internalType":"uint256","name":"rightId","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint8","name":"day","type":"uint8"}],"name":"isCurrentTimeMatchToDay","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"isPoolWithdrawable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"lastMinerBuyTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"lastPoolWithdrawTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"minerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"minerTokenPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"address","name":"leftChildAddress","type":"address"},{"internalType":"address","name":"rightChildAddress","type":"address"},{"internalType":"uint256","name":"oldLeftCount","type":"uint256"},{"internalType":"uint256","name":"oldRightCount","type":"uint256"},{"internalType":"uint256","name":"oldLeftSave","type":"uint256"},{"internalType":"uint256","name":"oldRightSave","type":"uint256"}],"name":"mpu","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"ownerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"pendingMinerFunds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"poolPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"uplineCode","type":"uint256"},{"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[],"name":"specialPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"specialPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"specialRewardPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"updateEntryFee","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"userTokenPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"withdrawPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"withdrawSpecials","outputs":[],"stateMutability":"nonpayable","type":"function"}
        ];
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        let provider, signer, contract, userAddress, isOwner = false;
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function log(message) {
            console.log(message);
            const box = document.getElementById('logBox');
            const item = document.createElement('div');
            item.className = 'log-item';
            item.textContent = `[${new Date().toLocaleTimeString('fa-IR')}] ${message}`;
            box.prepend(item);
            
            if (box.children.length > 20) {
                box.removeChild(box.lastChild);
            }
        }
        
        function showStatus(message, type = 'info') {
            const el = document.getElementById('userInfo');
            el.className = `status ${type}`;
            el.innerHTML = message;
            log(message);
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
        
        function showTab(tabName) {
            // Hide all tabs
            ['dashboardTab', 'registerTab', 'actionsTab', 'adminTab'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            // Refresh data if needed
            if (tabName === 'dashboard') {
                loadDashboard();
            }
        }
        
        // ==================== Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ ====================
        async function connectWallet() {
            log('ğŸ”— Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„...');
            
            if (typeof window.ethereum === 'undefined') {
                showStatus('âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                return;
            }
            
            try {
                showLoading(true);
                
                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                userAddress = accounts[0];
                log(`âœ… Ù…ØªØµÙ„ Ø´Ø¯: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¨Ú©Ù‡
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                log(`ğŸŒ Ø´Ø¨Ú©Ù‡: ${chainId}`);
                
                // Ø§Ú¯Ø± Ø´Ø¨Ú©Ù‡ Polygon Ù†ÛŒØ³Øª
                if (chainId !== POLYGON_CHAIN_ID) {
                    showStatus('ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Polygon...', 'info');
                    
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: POLYGON_CHAIN_ID }],
                        });
                        log('âœ… Ø´Ø¨Ú©Ù‡ Ø¨Ù‡ Polygon ØªØºÛŒÛŒØ± Ú©Ø±Ø¯');
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: POLYGON_CHAIN_ID,
                                    chainName: 'Polygon Mainnet',
                                    nativeCurrency: {
                                        name: 'MATIC',
                                        symbol: 'MATIC',
                                        decimals: 18
                                    },
                                    rpcUrls: ['https://polygon-rpc.com'],
                                    blockExplorerUrls: ['https://polygonscan.com']
                                }],
                            });
                            log('âœ… Ø´Ø¨Ú©Ù‡ Polygon Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                        }
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
                // Ø§ÛŒØ¬Ø§Ø¯ provider Ùˆ signer
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                
                // Ø³Ø§Ø®Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                log('ğŸ“œ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯');
                
                // ØªØºÛŒÛŒØ± UI
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('connectBtn').outerHTML = `
                    <div style="background: linear-gradient(90deg, #10b981, #34d399); color: white; padding: 10px 20px; border-radius: 8px; font-weight: bold;">
                        âœ… Ù…ØªØµÙ„: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}
                    </div>
                `;
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                await loadDashboard();
                
                showStatus('âœ… Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…ØªØµÙ„ Ø´Ø¯', 'success');
                
                // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        location.reload();
                    } else {
                        userAddress = accounts[0];
                        loadDashboard();
                    }
                });
                
                window.ethereum.on('chainChanged', () => {
                    location.reload();
                });
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                showStatus(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ====================
        async function loadDashboard() {
            if (!contract) return;
            
            try {
                log('ğŸ“Š Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...');
                
                // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ
                const [totalUsers, poolBalance, minerPool, specialPool] = await Promise.all([
                    contract.totalUsers().catch(() => 0),
                    contract.poolBalance().catch(() => 0),
                    contract.minerTokenPool().catch(() => 0),
                    contract.specialRewardPool().catch(() => 0)
                ]);
                
                document.getElementById('totalUsers').textContent = totalUsers.toString();
                document.getElementById('poolBalance').textContent = ethers.formatEther(poolBalance).substring(0, 8) + ' MATIC';
                document.getElementById('minerPool').textContent = ethers.formatEther(minerPool).substring(0, 8) + ' MATIC';
                document.getElementById('specialPool').textContent = ethers.formatEther(specialPool).substring(0, 8) + ' MATIC';
                
                // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                const userInfo = await contract.getUserInfo(userAddress).catch(() => null);
                if (userInfo) {
                    showStatus(`
                        ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± #${userInfo[0]}<br>
                        ğŸ“Š Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${userInfo[6]}<br>
                        ğŸ Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡: ${userInfo[7]}<br>
                        â›ï¸ Ù…Ø§ÛŒÙ†Ø±: ${userInfo[10] ? 'âœ…' : 'âŒ'}
                    `, 'success');
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø§Ù„Ú© Ø¨ÙˆØ¯Ù†
                    const owner = await contract.owner().catch(() => null);
                    if (owner && owner.toLowerCase() === userAddress.toLowerCase()) {
                        isOwner = true;
                        document.getElementById('adminTab').style.display = 'block';
                        log('ğŸ‘‘ Ú©Ø§Ø±Ø¨Ø± Ù…Ø§Ù„Ú© Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø§Ø³Øª');
                    }
                }
                
                log('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: ${error.message}`);
            }
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ====================
        
        // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
        async function register() {
            const uplineCode = document.getElementById('uplineCode').value;
            const position = document.getElementById('position').value === 'true';
            
            if (!uplineCode) {
                alert('Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ø¢Ù¾Ù„Ø§ÛŒÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            try {
                showLoading(true);
                log(`ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ø¢Ù¾Ù„Ø§ÛŒÙ† ${uplineCode} Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª ${position ? 'Ú†Ù¾' : 'Ø±Ø§Ø³Øª'}`);
                
                const tx = await contract.register(uplineCode, position, {
                    value: ENTRY_FEE
                });
                
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯: ${tx.hash}`);
                alert('ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯...');
                
                const receipt = await tx.wait();
                log(`âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚: ${receipt.hash}`);
                alert('âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!');
                
                await loadDashboard();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø±
        async function contribute() {
            const amount = document.getElementById('contribution').value;
            if (!amount || amount <= 0) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            try {
                showLoading(true);
                log(`ğŸ’° Ù…Ø´Ø§Ø±Ú©Øª ${amount} MATIC Ø¯Ø± Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø±`);
                
                const tx = await contract.contributeToMinerPool({
                    value: ethers.parseEther(amount)
                });
                
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                alert('ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                
                await tx.wait();
                log('âœ… Ù…Ø´Ø§Ø±Ú©Øª Ù…ÙˆÙÙ‚');
                alert('âœ… Ù…Ø´Ø§Ø±Ú©Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ù…Ø§ÛŒÙ†Ø±
        async function buyTokens() {
            try {
                showLoading(true);
                log('ğŸ›’ Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ù…Ø§ÛŒÙ†Ø±');
                
                const tx = await contract.buyMinerTokens();
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                
                await tx.wait();
                log('âœ… Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚');
                alert('âœ… Ø®Ø±ÛŒØ¯ ØªÙˆÚ©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§
        async function distribute() {
            try {
                showLoading(true);
                log('ğŸ“¤ ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§ÛŒÙ†Ø±');
                
                const tx = await contract.distributeMinerTokens();
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                
                await tx.wait();
                log('âœ… ØªÙˆØ²ÛŒØ¹ Ù…ÙˆÙÙ‚');
                alert('âœ… ØªÙˆØ²ÛŒØ¹ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø±
        async function withdrawPool() {
            try {
                showLoading(true);
                log('ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø§Ø³ØªØ®Ø±');
                
                const tx = await contract.withdrawPool();
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                alert('ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                
                await tx.wait();
                log('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ù…ÙˆÙÙ‚');
                alert('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                
                await loadDashboard();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡
        async function withdrawSpecial() {
            try {
                showLoading(true);
                log('ğŸ Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡');
                
                const tx = await contract.withdrawSpecials();
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                
                await tx.wait();
                log('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ù…ÙˆÙÙ‚');
                alert('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                
                await loadDashboard();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø§Ø¯Ù…ÛŒÙ†
        async function updateFee() {
            if (!isOwner) {
                alert('âŒ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù†ÛŒØ³ØªÛŒØ¯');
                return;
            }
            
            const newFee = document.getElementById('newFee').value;
            if (!newFee) {
                alert('Ù„Ø·ÙØ§Ù‹ Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            try {
                showLoading(true);
                log(`âš™ï¸ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¨Ù‡ ${newFee}`);
                
                const tx = await contract.updateEntryFee(newFee);
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                
                await tx.wait();
                log('âœ… Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙÙ‚');
                alert('âœ… Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        async function removeMiners() {
            if (!isOwner) {
                alert('âŒ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù†ÛŒØ³ØªÛŒØ¯');
                return;
            }
            
            const addressesText = document.getElementById('addresses').value;
            if (!addressesText) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const addresses = addressesText.split(',').map(a => a.trim()).filter(a => ethers.isAddress(a));
            if (addresses.length === 0) {
                alert('Ù‡ÛŒÚ† Ø¢Ø¯Ø±Ø³ Ù…Ø¹ØªØ¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }
            
            try {
                showLoading(true);
                log(`ğŸš« Ø­Ø°Ù ${addresses.length} Ù…Ø§ÛŒÙ†Ø±`);
                
                const tx = await contract.batchRemoveMiners(addresses);
                log(`â³ ØªØ±Ø§Ú©Ù†Ø´: ${tx.hash}`);
                
                await tx.wait();
                log('âœ… Ø­Ø°Ù Ù…ÙˆÙÙ‚');
                alert(`âœ… ${addresses.length} Ù…Ø§ÛŒÙ†Ø± Ø­Ø°Ù Ø´Ø¯Ù†Ø¯`);
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`);
                alert(`Ø®Ø·Ø§: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        window.onload = function() {
            log('ğŸš€ SPS DApp Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯');
            
            // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡
            document.getElementById('connectBtn').onclick = connectWallet;
            
            // Ø§Ú¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ù…ØªØµÙ„ Ø´Ø¯Ù‡
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            log('ğŸ”— Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„...');
                            connectWallet();
                        }
                    });
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² RPC Ø¹Ù…ÙˆÙ…ÛŒ
            loadDashboard();
        };
    </script>
</body>
</html>